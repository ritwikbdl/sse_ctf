// gcc -fno-stack-protector -z execstack -g -o stars Dumped.c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>
#include <string.h>
# define LEN 90

void ignore_me_init_buffering() {
	setvbuf(stdout, NULL, _IONBF, 0);
	setvbuf(stdin, NULL, _IONBF, 0);
	setvbuf(stderr, NULL, _IONBF, 0);
}

void kill_on_timeout(int sig) {
  if (sig == SIGALRM) {
  	printf("[!] Anti DoS Signal. Patch me out for testing.");
    exit(0);
  }
}

void ignore_me_init_signal() {
	signal(SIGALRM, kill_on_timeout);
	alarm(60*3);
}

void start(void)
{
    char buf [LEN];
    int len;
    printf("Here's the dumpster number where the flag was dumped: %p\n", buf);
    printf("Enter the size of trash you're throwing: ");
    scanf("%d", &len);
    fflush(stdin);

    if(len > LEN) {
        printf("Too much trash for normal human!\n");
        exit(0);
    }
    printf("Enter your trash: ");
    int input_len = read(0, buf, (unsigned)len);
    fflush(stdin);
    printf("Dumped your trash.\n");  
}

void banner(){
    printf("                                                                                \n           (/////////////////////////////////////////////////////////*          \n         (((//////////////////////////////////////////////////////////(/        \n        ((((////////////////////////////////////////////////////////((((*       \n       /(((((///////////////////////////////////////////////////////(((((,      \n      (((((((//////////////////////////////////////////////////////(((((((      \n      ,*******************************************************************      \n       *******************************************************************      \n       ******************************************************************,      \n       ******************************************************************.      \n       ,*****************************************************************       \n        *********/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*//       \n        /**********************//*,,/,         *////////////////////////*       \n        *////////////////////*/.      .,         ///////////////////////.       \n        ,////////////////////*         */          *////////////////////        \n         ///////////////////,         ////,       //////////////////////        \n         //////////////////////*    .////*****,,,//////////////////////*        \n         //////////////**,,*,,,////*//////////////.   /////////////////.        \n         .//////////////*       //////////////.        ,///////////////         \n          /////////////.         */////////////*         //////////////         \n          /////////////        //////////////////       ,//////////////         \n          (/////////////,    ,/////////////( //////**//*//////////////.         \n          ,///////////////. /          ///.           ////////////////          \n           ////////////////*.          //.          ./////////////////          \n           //////////////////,         (/(/        *//////////////////          \n           //(/(/(/(/(/(/(/(//(//(/(/(/(/(/(.//(///(/(/(/(/(/(/(/(/(/.          \n           ,(((((((((((((((((((((((((((((((((/(((((((((((((((((((((((           \n            ((((((((((((((((((((((((((((((((((((((((((((((((((((((((/           \n            ((((((((((((((((((((((((((((((((((((((((((((((((((((((((/           \n            /(((((((((((((((((((((((((((((((((((((((((((((((((((((((.           \n            ,(((((((((((((((((((((((((((((((((((((((((((((((((((((((            \n                                                                                \n");
}

int main(){
	ignore_me_init_buffering();
	ignore_me_init_signal();
  banner();
  start();
  puts("Oops! The trash is not full!\n");
	return 0;
}
