// gcc -fno-stack-protector -z execstack -g -o dumped dumped.c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>
#include <string.h>
# define LEN 90

void ignore_me_init_buffering() {
	setvbuf(stdout, NULL, _IONBF, 0);
	setvbuf(stdin, NULL, _IONBF, 0);
	setvbuf(stderr, NULL, _IONBF, 0);
}

void kill_on_timeout(int sig) {
  if (sig == SIGALRM) {
  	printf("[!] Anti DoS Signal.\n");
    exit(0);
  }
}

void ignore_me_init_signal() {
	signal(SIGALRM, kill_on_timeout);
	alarm(60);
}

void start(void)
{
    char buf [LEN]="\0";
    int len;
    printf("You are dumping your trash in dumpster number: %p\n", buf);
    printf("Enter the size of trash you're throwing: ");
    scanf("%d", &len);
    fflush(stdin);
    if(len > LEN) {
        printf("I cannot accept to much trash in one go!\n");
        exit(0);
    }
    printf("Enter your trash: ");
    int input_len = read(0, buf, (unsigned)len);
    fflush(stdin);
    printf("Dumped your trash.\n");  
}

void banner(){
    printf("                                                                                \n           (/////////////////////////////////////////////////////////*          \n         (((//////////////////////////////////////////////////////////(/        \n        ((((////////////////////////////////////////////////////////((((*       \n       /(((((///////////////////////////////////////////////////////(((((,      \n      (((((((//////////////////////////////////////////////////////(((((((      \n      ,*******************************************************************      \n       *******************************************************************      \n       ******************************************************************,      \n       ******************************************************************.      \n       ,*****************************************************************       \n        *********/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*//       \n        /**********************//*,,/,         *////////////////////////*       \n        *////////////////////*/.      .,         ///////////////////////.       \n        ,////////////////////*         */          *////////////////////        \n         ///////////////////,         ////,       //////////////////////        \n         //////////////////////*    .////*****,,,//////////////////////*        \n         //////////////**,,*,,,////*//////////////.   /////////////////.        \n         .//////////////*       //////////////.        ,///////////////         \n          /////////////.         */////////////*         //////////////         \n          /////////////        //////////////////       ,//////////////         \n          (/////////////,    ,/////////////( //////**//*//////////////.         \n          ,///////////////. /          ///.           ////////////////          \n           ////////////////*.          //.          ./////////////////          \n           //////////////////,         (/(/        *//////////////////          \n           //(/(/(/(/(/(/(/(//(//(/(/(/(/(/(.//(///(/(/(/(/(/(/(/(/(/.          \n           ,(((((((((((((((((((((((((((((((((/(((((((((((((((((((((((           \n            ((((((((((((((((((((((((((((((((((((((((((((((((((((((((/           \n            ((((((((((((((((((((((((((((((((((((((((((((((((((((((((/           \n            /(((((((((((((((((((((((((((((((((((((((((((((((((((((((.           \n            ,(((((((((((((((((((((((((((((((((((((((((((((((((((((((            \n                                                                                \n");
}

int main(){
    char option;

    ignore_me_init_buffering();
	ignore_me_init_signal();
    banner();

    printf("You have trash to dump? (y/n): ");

    while(1){
		fflush(stdin);
		// fseek(stdin, 55, SEEK_END);
        scanf(" %c", &option);
        if (option == 'y'){
            start();
            printf("\nMore trash? (y/n): ");
        }
        else if (option == 'n')
            return 0;
        else
            printf("\nOhh ho! Wrong option. Try again? (y/n): ");

    }
	return 0;
}