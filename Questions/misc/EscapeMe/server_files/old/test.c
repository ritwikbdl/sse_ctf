#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>
#include <string.h>
#define LEN 90

void ignore_me_init_buffering()
{
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
}

void kill_on_timeout(int sig)
{
    if (sig == SIGALRM)
    {
        printf("[!] Anti DoS Signal.\n");
        exit(0);
    }
}

void ignore_me_init_signal()
{
    signal(SIGALRM, kill_on_timeout);
    alarm(10000);
}

void clear_stdin()
{
    while (getchar() != '\n')
        ;
}

void start(void)
{
    char buf[LEN] = "\0";
    char str[10] = "\0";
    printf("Enter your data: ");
    clear_stdin();
    // fflush(stdin);
    // gets(str);
    scanf("%[^;\n]%*c", str);
    printf("str = %s\n", str);
    snprintf(buf, 90, "echo %s > /tmp/data.txt", str);
    printf("buf = %s", buf);
    system(buf);
}

void banner()
{
    printf("                                                                                \n           (/////////////////////////////////////////////////////////*          \n         (((//////////////////////////////////////////////////////////(/        \n        ((((////////////////////////////////////////////////////////((((*       \n       /(((((///////////////////////////////////////////////////////(((((,      \n      (((((((//////////////////////////////////////////////////////(((((((      \n      ,*******************************************************************      \n       *******************************************************************      \n       ******************************************************************,      \n       ******************************************************************.      \n       ,*****************************************************************       \n        *********/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*/*//       \n        /**********************//*,,/,         *////////////////////////*       \n        *////////////////////*/.      .,         ///////////////////////.       \n        ,////////////////////*         */          *////////////////////        \n         ///////////////////,         ////,       //////////////////////        \n         //////////////////////*    .////*****,,,//////////////////////*        \n         //////////////**,,*,,,////*//////////////.   /////////////////.        \n         .//////////////*       //////////////.        ,///////////////         \n          /////////////.         */////////////*         //////////////         \n          /////////////        //////////////////       ,//////////////         \n          (/////////////,    ,/////////////( //////**//*//////////////.         \n          ,///////////////. /          ///.           ////////////////          \n           ////////////////*.          //.          ./////////////////          \n           //////////////////,         (/(/        *//////////////////          \n           //(/(/(/(/(/(/(/(//(//(/(/(/(/(/(.//(///(/(/(/(/(/(/(/(/(/.          \n           ,(((((((((((((((((((((((((((((((((/(((((((((((((((((((((((           \n            ((((((((((((((((((((((((((((((((((((((((((((((((((((((((/           \n            ((((((((((((((((((((((((((((((((((((((((((((((((((((((((/           \n            /(((((((((((((((((((((((((((((((((((((((((((((((((((((((.           \n            ,(((((((((((((((((((((((((((((((((((((((((((((((((((((((            \n                                                                                \n");
}

int main()
{
    char option;

    ignore_me_init_buffering();
    ignore_me_init_signal();
    banner();

    printf("You have trash to dump? (y/n): ");

    while (1)
    {
        fflush(stdin);
        // fseek(stdin, 55, SEEK_END);
        scanf(" %c", &option);
        if (option == 'y')
        {
            start();
            printf("\nMore trash? (y/n): ");
        }
        else if (option == 'n')
            return 0;
        else
            printf("\nOhh ho! Wrong option. Try again? (y/n): ");
    }
    return 0;
}
